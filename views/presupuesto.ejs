<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="img/Logo.ico" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet" href="dist/output.css">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <title>Presupuesto: <%= presupuesto.nombre %></title>
  <!-- En el <head> de tu EJS -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-gauge@0.3.0/dist/chartjs-gauge.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- AÃ±ade estas configuraciones de Tailwind -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              600: '#2563eb',
              700: '#1d4ed8',
            },
            danger: {
              600: '#dc2626',
              700: '#b91c1c',
            },
            success: {
              600: '#16a34a',
              700: '#15803d',
            }
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            display: ['Bebas Neue', 'sans-serif'],
          },
        }
      }
    }
  </script>
  
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    .modal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.4);
    }
    .modal-content {
      background-color: #fefefe;
      margin: 10% auto;
      padding: 20px;
      border-radius: 8px;
      width: 80%;
      max-width: 500px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .close-btn {
      float: right;
      cursor: pointer;
      font-size: 1.5rem;
    }
  </style>
  
  <style>
	  /* AÃ±ade esto en el <head> */
	  .descripcion-cell {
		word-break: break-word;
		max-width: 200px; /* Ajusta este valor segÃºn necesites */
	  }
	</style>
</head>
<body class="font-sans bg-gray-50">

  <!-- Navbar mejorada -->
  <nav class="bg-white shadow-sm fixed top-0 left-0 w-full z-50 px-4 py-3 flex flex-col md:flex-row justify-between items-center">
    <div class="w-full md:w-auto flex justify-between items-center">
      <!-- BotÃ³n de regreso -->
      <a href="/principal" class="text-lg font-medium text-gray-800 hover:text-primary-600 transition-colors flex items-center">
        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"></path>
        </svg>
        Volver
      </a>
      
      <!-- BotÃ³n mÃ³vil (opcional para menÃº) -->
      <button class="md:hidden text-gray-600">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
        </svg>
      </button>
    </div>

    <!-- Botones de acciÃ³n -->
    <div class="mt-2 md:mt-0 space-x-2 md:space-x-4">
      <a href="/gastos/nuevo/<%= presupuesto.idPresupuesto %>" class="inline-flex items-center bg-danger-600 text-white px-4 py-2 rounded hover:bg-danger-700 shadow-sm transition duration-150">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
        </svg>
        <span class="hidden md:inline">Registrar Gasto</span>
        <span class="md:hidden">Gasto</span>
      </a>
      <a href="/ingresos/nuevo/<%= presupuesto.idPresupuesto %>" class="inline-flex items-center bg-success-600 text-white px-4 py-2 rounded hover:bg-success-700 shadow-sm transition duration-150">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
        </svg>
        <span class="hidden md:inline">Registrar Ingreso</span>
        <span class="md:hidden">Ingreso</span>
      </a>
    </div>
  </nav>

  <!-- Espacio para navbar fija -->
  <div class="pt-24 md:pt-20"></div>

  <!-- Encabezado mejorado -->
  <div class="container mx-auto px-4 pb-20">
    <div class="text-center">
      <div class="inline-flex items-center justify-center space-x-3">
        <span class="text-4xl">ðŸ’°</span>
        <h1 class="text-3xl md:text-4xl font-display text-gray-800"><%= presupuesto.nombre %></h1>
      </div>

      <!-- Rango de fechas mejorado -->
      <div class="flex flex-col md:flex-row justify-center items-center mt-2 space-y-1 md:space-y-0 md:space-x-6">
        <div class="flex items-center text-primary-600">
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
          <span><%= presupuesto.fecha_inicio%></span>
        </div>
        <span class="text-gray-400">â†’</span>
        <div class="flex items-center text-primary-600">
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
          <span><%= presupuesto.fecha_fin %></span>
        </div>
      </div>
    </div>

<!-- SECCIÃ“N PRESUPUESTO (lo mÃ¡s importante) -->
<div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4">
  <!-- PRESUPUESTO INICIAL -->
  <div class="bg-white p-5 rounded-xl shadow-md border-t-4 border-yellow-400 relative group">
    <div class="flex items-center justify-between mb-2">
      <div class="flex items-center">
        <svg class="w-6 h-6 mr-2 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <h3 class="text-lg font-bold text-gray-700">Presupuesto Inicial</h3>
      </div>
      <div class="relative inline-block">
        <svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span class="absolute z-10 w-48 bg-black text-white text-xs p-2 rounded-md -left-20 -top-10 opacity-0 invisible md:visible md:group-hover:opacity-100 transition-opacity">
          LÃ­mite mÃ¡ximo que estableciste para tus gastos en este perÃ­odo
        </span>
      </div>
    </div>
    <p class="text-3xl font-bold text-gray-800">$<%= parseFloat(presupuesto.monto).toFixed(2) %></p>
    <p class="text-sm text-gray-500 mt-1">CategorÃ­a: <%= presupuesto.categoria %></p>
  </div>

  <!-- ESTADO ACTUAL -->
  <div class="bg-white p-5 rounded-xl shadow-md border-t-4 <%= totales.gastos > presupuesto.monto ? 'border-red-500' : 'border-green-500' %> relative group">
    <div class="flex items-center justify-between mb-2">
      <div class="flex items-center">
        <svg class="w-6 h-6 mr-2 <%= totales.gastos > presupuesto.monto ? 'text-red-500' : 'text-green-500' %>" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
        </svg>
        <h3 class="text-lg font-bold text-gray-700">Estado Actual</h3>
      </div>
      <div class="relative inline-block">
        <svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span class="absolute z-10 w-48 bg-black text-white text-xs p-2 rounded-md -left-40 -top-10 opacity-0 invisible md:visible md:group-hover:opacity-100 transition-opacity">
          <% if(totales.gastos > presupuesto.monto) { %>
            Â¡Has excedido tu presupuesto disponible!
          <% } else { %>
            ComparaciÃ³n entre lo gastado y tu presupuesto
          <% } %>
        </span>
      </div>
    </div>
    <div class="flex items-end justify-between">
      <div>
        <p class="text-2xl font-bold <%= totales.gastos > presupuesto.monto ? 'text-red-500' : 'text-green-500' %>">
          $<%= Math.abs(presupuesto.monto - totales.gastos).toFixed(2) %>
        </p>
        <p class="text-sm <%= totales.gastos > presupuesto.monto ? 'text-red-500' : 'text-gray-600' %>">
          <% if(totales.gastos > presupuesto.monto) { %>
            Excedido por $<%= (totales.gastos - presupuesto.monto).toFixed(2) %>
          <% } else { %>
            Disponible ($<%= (presupuesto.monto - totales.gastos).toFixed(2) %>)
          <% } %>
        </p>
      </div>
      <span class="px-3 py-1 rounded-full text-sm font-medium <%= totales.gastos > presupuesto.monto ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800' %>">
        <% const porcentaje = (totales.gastos / presupuesto.monto) * 100; %>
        <%= Math.min(porcentaje, 100).toFixed(0) %>%
      </span>
    </div>
  </div>
</div>

<!-- BARRA DE PROGRESO VISUAL MEJORADA -->
<div class="mt-6 bg-white p-4 rounded-xl shadow-md relative group">
  <div class="flex items-center justify-between mb-1">
    <div class="flex items-center">
      <svg class="w-5 h-5 mr-1 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
      </svg>
      <span class="text-sm font-medium text-gray-700">Progreso de gastos</span>
    </div>
    <div class="flex items-center">
      <span class="text-sm font-medium text-gray-700 mr-2"><%= Math.min(porcentaje, 100).toFixed(1) %>% usado</span>
      <div class="relative inline-block">
        <svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span class="absolute z-10 w-48 bg-black text-white text-xs p-2 rounded-md left-0 md:-left-48 -top-10 opacity-0 invisible md:visible md:group-hover:opacity-100 transition-opacity">
          Porcentaje de tu presupuesto que ya has utilizado
          <% if(porcentaje > 80) { %>
            <br><span class="font-bold">Â¡EstÃ¡s cerca del lÃ­mite!</span>
          <% } %>
        </span>
      </div>
    </div>
  </div>
  <div class="w-full bg-gray-200 rounded-full h-3">
    <div class="h-3 rounded-full <%= porcentaje > 100 ? 'bg-red-500' : porcentaje > 80 ? 'bg-yellow-500' : 'bg-green-500' %>" 
         style="width: <%= Math.min(porcentaje, 100) %>%">
    </div>
  </div>
  <div class="mt-1 flex justify-between text-xs text-gray-500">
    <span> <%= presupuesto.monto - totales.gastos %>$</span>
    <span class="font-medium">Presupuesto: $<%= parseFloat(presupuesto.monto).toFixed(2) %></span>
  </div>
  <% if(porcentaje > 80) { %>
    <div class="mt-2 text-xs <%= porcentaje > 100 ? 'text-red-600' : 'text-yellow-600' %> font-medium">
      <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
      </svg>
      <% if(porcentaje > 100) { %>
        Â¡Has superado tu presupuesto un <%= (porcentaje - 100).toFixed(1) %>%!
      <% } else { %>
        Â¡Has utilizado el <%= porcentaje.toFixed(0) %>% de tu presupuesto!
      <% } %>
	<% }else { %>
	<div class="mt-2 text-xs <%= porcentaje < 50 ? 'text-blue-600' : 'text-purple-600' %> font-medium">
      <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
      </svg>
	Â¡Has utilizado el <%= porcentaje.toFixed(0) %>% de tu presupuesto!
	<% } %>
    </div>
</div>

<!-- SECCIÃ“N DE BALANCE GENERAL -->
<div class="mt-8">
  <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
    <svg class="w-5 h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
    </svg>
    Balance General
    <div class="relative inline-block ml-2">
      <svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <span class="absolute z-10 w-64 bg-black text-white text-xs p-2 rounded-md left-0 md:-left-64 -top-10 opacity-0 invisible md:visible md:group-hover:opacity-100 transition-opacity">
        Resumen financiero completo (Ingresos - Gastos). Independiente de tu presupuesto inicial.
      </span>
    </div>
  </h3>
  
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <!-- INGRESOS -->
    <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-green-500 relative group">
      <div class="flex justify-between items-start">
        <div>
          <h4 class="text-sm font-medium text-gray-500">Ingresos Totales</h4>
          <p class="text-2xl font-bold text-green-600">+$<%= parseFloat(totales.ingresos).toFixed(2) %></p>
        </div>
        <div class="relative inline-block">
          <svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <span class="absolute z-10 w-48 bg-black text-white text-xs p-2 rounded-md left-0 md:-left-48 -top-10 opacity-0 invisible md:visible md:group-hover:opacity-100 transition-opacity">
            Sumatoria de todos tus ingresos registrados
          </span>
        </div>
      </div>
      <% if(ingresos.length > 0) { %>
        <p class="text-xs text-gray-500 mt-1"><%= ingresos.length %> registro(s)</p>
      <% } %>
    </div>
    
    <!-- GASTOS -->
    <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-red-500 relative group">
      <div class="flex justify-between items-start">
        <div>
          <h4 class="text-sm font-medium text-gray-500">Gastos Totales</h4>
          <p class="text-2xl font-bold text-red-600">-$<%= parseFloat(totales.gastos).toFixed(2) %></p>
        </div>
        <div class="relative inline-block">
          <svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <span class="absolute z-10 w-48 bg-black text-white text-xs p-2 rounded-md left-0 md:-left-48 -top-10 opacity-0 invisible md:visible md:group-hover:opacity-100 transition-opacity">
            Sumatoria de todos tus gastos registrados
          </span>
        </div>
      </div>
      <% if(gastos.length > 0) { %>
        <p class="text-xs text-gray-500 mt-1"><%= gastos.length %> registro(s)</p>
      <% } %>
    </div>
    
    <!-- BALANCE FINAL -->
    <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 <%= totales.balance >= 0 ? 'border-blue-500' : 'border-red-500' %> relative group">
      <div class="flex justify-between items-start">
        <div>
          <h4 class="text-sm font-medium text-gray-500">Balance Final</h4>
          <p class="text-2xl font-bold <%= totales.balance >= 0 ? 'text-blue-600' : 'text-red-600' %>">
            <%= totales.balance >= 0 ? '+' : '' %>$<%= parseFloat(totales.balance).toFixed(2) %>
          </p>
        </div>
        <div class="relative inline-block">
          <svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <span class="absolute z-10 w-64 bg-black text-white text-xs p-2 rounded-md left-0 md:-left-64 -top-10 opacity-0 invisible md:visible md:group-hover:opacity-100 transition-opacity">
            <% if(totales.balance >= 0) { %>
              Â¡Buen trabajo! Tus ingresos superan tus gastos
            <% } else { %>
              Tus gastos superan tus ingresos. Considera ajustar tus gastos o aumentar ingresos
            <% } %>
          </span>
        </div>
      </div>
      <p class="text-xs <%= totales.balance >= 0 ? 'text-blue-600' : 'text-red-600' %> mt-1">
        <% if(totales.balance >= 0) { %>
          <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
          </svg>
          Saldo positivo
        <% } else { %>
          <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
          </svg>
          Saldo negativo
        <% } %>
      </p>
    </div>
  </div>
</div>
	
    <!-- Tablas responsive -->
    <div class="mt-10 grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- GASTOS -->
      <div class="bg-white rounded-lg shadow-sm overflow-hidden">
        <div class="px-4 py-3 border-b flex justify-between items-center">
          <h2 class="text-lg font-bold text-danger-600">Gastos</h2>
          <span class="bg-danger-100 text-danger-800 text-xs font-medium px-2.5 py-0.5 rounded">
            <%= gastos.length %> registros
          </span>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead class="bg-gray-50 text-gray-700">
              <tr>
                <th class="p-3 text-left">#</th>
				<th class="p-3 text-left">Tipo de Gasto</th> <!-- Nueva columna -->
                <th class="p-3 text-left">DescripciÃ³n</th>
                <th class="p-3 text-right">Valor</th>
                <th class="p-3 text-center">Acciones</th>
              </tr>
            </thead>
            <tbody class="divide-y">
              <% gastos.forEach((gasto, index) => { %>
                <tr class="transition-colors hover:bg-danger-50 <%= gasto.deleted ? 'hidden' : '' %>">
                  <td class="p-3 text-gray-500"><%= index + 1 %></td>
				  <td class="p-3 font-medium"><%= gasto.tipo %></td> <!-- Nueva celda -->
                  <td class="p-3 font-medium descripcion-cell"><%= gasto.descripcion %></td>
                  <td class="p-3 text-right text-danger-600 font-medium">$<%= parseFloat(gasto.valor).toFixed(2) %></td>
                  <td class="p-3 text-center space-x-3">
                    <button onclick="openEditModal('gasto', '<%= gasto.idGastos %>', '<%= gasto.descripcion %>', '<%= gasto.valor %>')" 
						  class="text-primary-600 hover:text-primary-700" title="Editar">
					<svg class="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
					</svg>
				  </button>
				  <button onclick="confirmDelete('gasto', '<%= gasto.idGastos %>')" 
						  class="text-danger-600 hover:text-danger-700" title="Eliminar">
					<svg class="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
					</svg>
				  </button>
                  </td>
                </tr>
              <% }) %>
              <% if(gastos.length === 0) { %>
                <tr>
                  <td colspan="4" class="p-4 text-center text-gray-500">No hay gastos registrados</td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>

      <!-- INGRESOS -->
      <div class="bg-white rounded-lg shadow-sm overflow-hidden">
        <div class="px-4 py-3 border-b flex justify-between items-center">
          <h2 class="text-lg font-bold text-success-600">Ingresos</h2>
          <span class="bg-success-100 text-success-800 text-xs font-medium px-2.5 py-0.5 rounded">
            <%= ingresos.length %> registros
          </span>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead class="bg-gray-50 text-gray-700">
              <tr>
                <th class="p-3 text-left">#</th>
				<th class="p-3 text-left">Tipo de Ingreso</th> <!-- Nueva columna -->
                <th class="p-3 text-left">DescripciÃ³n</th>
                <th class="p-3 text-right">Valor</th>
                <th class="p-3 text-center">Acciones</th>
              </tr>
            </thead>
            <tbody class="divide-y">
              <% ingresos.forEach((ingreso, index) => { %>
                <tr class="transition-colors hover:bg-success-50 <%= ingreso.deleted ? 'hidden' : '' %>">
                  <td class="p-3 text-gray-500"><%= index + 1 %></td>
				  <td class="p-3 font-medium"><%= ingreso.tipo %></td> <!-- Nueva celda -->
                  <td class="p-3 font-medium descripcion-cell"><%= ingreso.descripcion %></td>
                  <td class="p-3 text-right text-success-600 font-medium">$<%= parseFloat(ingreso.valor).toFixed(2) %></td>
                  <td class="p-3 text-center space-x-3">
                    <button onclick="openEditModal('ingreso', '<%= ingreso.idIngresos %>', '<%= ingreso.descripcion %>', '<%= ingreso.valor %>')" 
							  class="text-primary-600 hover:text-primary-700" title="Editar">
						<svg class="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
						</svg>
					  </button>
					  <button onclick="confirmDelete('ingreso', '<%= ingreso.idIngresos %>')" 
							  class="text-danger-600 hover:text-danger-700" title="Eliminar">
						<svg class="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
						</svg>
					  </button>
                  </td>
                </tr>
              <% }) %>
              <% if(ingresos.length === 0) { %>
                <tr>
                  <td colspan="4" class="p-4 text-center text-gray-500">No hay ingresos registrados</td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de confirmaciÃ³n (oculto por defecto) -->
  <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg p-6 max-w-md w-full">
      <h3 class="text-lg font-bold mb-4">Confirmar eliminaciÃ³n</h3>
      <p class="text-gray-600 mb-6">Â¿EstÃ¡s seguro que deseas eliminar este registro? Esta acciÃ³n no se puede deshacer.</p>
      <div class="flex justify-end space-x-3">
        <button id="cancelBtn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">Cancelar</button>
        <button id="confirmBtn" class="px-4 py-2 bg-danger-600 text-white rounded-md hover:bg-danger-700">Eliminar</button>
      </div>
    </div>
  </div>

  <script>
    // Script para manejar la confirmaciÃ³n de eliminaciÃ³n
    document.querySelectorAll('a[href^="/gastos/eliminar/"], a[href^="/ingresos/eliminar/"]').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const modal = document.getElementById('confirmModal');
        const confirmBtn = document.getElementById('confirmBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        
        modal.classList.remove('hidden');
        
        confirmBtn.onclick = function() {
          window.location.href = e.target.closest('a').href;
        };
        
        cancelBtn.onclick = function() {
          modal.classList.add('hidden');
        };
      });
    });
  </script>
  
    <!-- Modal para Editar -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('editModal')">&times;</span>
      <h2 class="text-xl font-bold mb-4" id="modalTitle">Editar</h2>
      <form id="editForm">
        <input type="hidden" id="editId" name="id">
        <input type="hidden" id="editType" name="type">
        
        <div class="mb-4">
          <label class="block text-gray-700 mb-2">DescripciÃ³n</label>
          <input type="text" id="editDescripcion" name="descripcion" 
                 class="w-full px-3 py-2 border rounded" required>
        </div>
        
        <div class="mb-4">
          <label class="block text-gray-700 mb-2">Valor</label>
          <input type="number" id="editValor" name="valor" 
                 class="w-full px-3 py-2 border rounded" min="0" step="0.01" required>
        </div>
        
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
          Guardar Cambios
        </button>
      </form>
    </div>
  </div>

  <!-- Scripts para manejar los modales -->
  <script>
    // FunciÃ³n para abrir modal de ediciÃ³n
    function openEditModal(type, id, descripcion, valor) {
      document.getElementById('editType').value = type;
      document.getElementById('editId').value = id;
      document.getElementById('editDescripcion').value = descripcion;
      document.getElementById('editValor').value = valor;
      document.getElementById('modalTitle').textContent = `Editar ${type === 'gasto' ? 'Gasto' : 'Ingreso'}`;
      document.getElementById('editModal').style.display = 'block';
    }

    // FunciÃ³n para cerrar modales
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    // Manejar envÃ­o del formulario de ediciÃ³n
    document.getElementById('editForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const formData = {
        id: document.getElementById('editId').value,
        type: document.getElementById('editType').value,
        descripcion: document.getElementById('editDescripcion').value,
        valor: document.getElementById('editValor').value
      };

      try {
        const response = await fetch(`/${formData.type}s/editar/${formData.id}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            descripcion: formData.descripcion,
            valor: formData.valor
          })
        });

        if (response.ok) {
          window.location.reload();
        } else {
          Swal.fire('Error', 'No se pudo actualizar', 'error');
        }
      } catch (error) {
        Swal.fire('Error', 'Error de conexiÃ³n', 'error');
      }
    });

    // FunciÃ³n para confirmar eliminaciÃ³n
    async function confirmDelete(type, id) {
  const row = event.target.closest('tr'); // Obtiene la fila actual
  
  const result = await Swal.fire({
    title: 'Â¿EstÃ¡s seguro?',
    text: `Esta acciÃ³n eliminarÃ¡ el ${type === 'gasto' ? 'gasto' : 'ingreso'} seleccionado`,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#d33',
    cancelButtonColor: '#3085d6',
    confirmButtonText: 'SÃ­, eliminar',
    cancelButtonText: 'Cancelar'
  });

  if (result.isConfirmed) {
    // Ocultar la fila inmediatamente
    row.style.opacity = '0.5';
    row.style.transition = 'opacity 0.3s ease';
    
    try {
      const response = await fetch(`/${type}s/${id}`, {
        method: 'DELETE'
      });

      if (response.ok) {
        // Eliminar completamente la fila despuÃ©s de la animaciÃ³n
        setTimeout(() => {
          row.remove();
          // Actualizar los nÃºmeros (#) de las filas restantes
          updateRowNumbers(type);
        }, 300);
        
        Swal.fire(
          'Eliminado!',
          `El ${type === 'gasto' ? 'gasto' : 'ingreso'} ha sido eliminado.`,
          'success'
        );
      } else {
        row.style.opacity = '1';
        Swal.fire('Error', 'No se pudo eliminar', 'error');
      }
    } catch (error) {
      row.style.opacity = '1';
      Swal.fire('Error', 'Error de conexiÃ³n', 'error');
    }
  }
}

    // Cerrar modal al hacer clic fuera del contenido
    window.onclick = function(event) {
      if (event.target.className === 'modal') {
        event.target.style.display = 'none';
      }
    }
  </script>
  
</body>
</html>